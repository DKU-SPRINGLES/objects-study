# 책임할당을 위한 GRASP 패턴

## 책임주도 설계를 위해

- 객체의 행동을 결정한 뒤 객체의 상태를 결정해야 한다
- 객체의 책임은 협력에 적합해야한다
  - 이때 협력을 시작하는 주체는 클라이언트 이므로, 클라이언트의 의도에 적합한 책임을 할당하면 된다.
  
## GRASP 패턴

- 책임 할당을 위한 소프트웨어 패턴(General Responsibility Assignment Software Pattern)

### 도메인 개념에서 출발하기

- 설계 시작단계에서는 개념들의 의미와 관계가 정확하고 완벽할 필요가 없다.
- 올바른 도메인 모델이란 존재하지 않는다.

1. 애플리케이션의 인풋을 애플리케이션에 대해 전송된 메시지로 간주하여 첫 객체를 선택한다
- 책임을 수행하는데 필요한 정보를 가진 객체에 책임을 할당한다(정보전문가 패턴)
2. 선택된 객체가 메시지를 처리하는데 필요한 작업을 구상한다
- 스스로 처리할 수 없는 작업이 있다면 외부에 도움을 요청해야 한다
- 새로운 메시지를 만들어 외부 객체에 도움을 요청하는 1의 과정을 반복한다

### 높은 응집도 낮은 결합도

- 책임할당의 다양한 대안이 존재한다면, 응집도와 결합도의 측면에서 더 나은 대안을 선택한다
- **LOW COUPLING PATTERN** : 불필요한 결합도를 추가하지 않도록 한다
- **HIGH COHENSION PATTERN** : 서로 다른 이유로 변경되는 책임을 짊어지게 하지 않는다

### 창조자에게 객체 생성 책임을 할당하라

객체 A를 생성해야 할 때, 아래의 조건을 가장 많이 만족하는 B에게 객체 생성의 책임을 할당하라
> - B가 A객체를 포함하거나 참조한다
> - B가 A객체를 기록한다
> - B가 A객체를 긴밀하게 사용한다
> - B가 A객체 생성을 위한 정보를 가지고 있다.


## 구현을 통한 검증

### 높은 응집도를 위해 변경의 이유에 따라 클래스를 분리해야 한다

변경의 이유를 파악할 수 있는 방법
1. 인스턴스 변수가 초기화 되는 시점
- 응집도가 높은 클래스는 인스턴스 생성시 모든 속성을 함께 초기화하는 반면, 응집도가 낮은 클래스는 객체의 속성중 일부만 초기화 하고 일부는 초기화 하지 않는다.
- 함께 초기화되는 속성을 기준으로 코드를 분리하라

2. 메서드들이 인스턴스 변수를 사용하는 방식
- 모든 메서드가 객체의 모든 속성을 사용한다면 클래스의 응집도가 높다
- 그렇지 않고 속성에 따라 그룹이 나뉜다면 클래스의 응집도는 낮다
- 속성 그룹과 해당 그룹에 접근하는 메서드 그룹을 기준으로 코드를 분리해야 한다

### 타입은 다형성을 통해 분리하기

- 기간 할인 조건, 순번 할인 조건 모두 할인 조건이라는 역할로 추상화하여 외부의 객체가 추상에 의존하도록 설계할 수 있다(DIP)
- **POLYMORPHISM(다형성)패턴** : 객체의 타입에 따라 변하는 로직이 있을 때 타입을 명시적으로 정의하고 각 타입에 다형적으로 행동하는 책임을 할당하면 된다
- 조건 논리(switch, if~else)를 통해 설계한다면 새로운 변화가 일어나는 경우 조건논리를 추가적으로 수정해야한다

### 변경으로 부터의 보호

- 추상에 의존하는 외부 객체는 새로운 역할이 추가되더라도 수정될 필요가 없다.
- 이처럼 변경을 캡슐화 하도록 책임을 할당하는 것을 **PROTECTED VARIATIONS**패턴이라고 부른다

## 책임 주도 설계의 대안

일단 데이터 중심으로 구현한 후 리팩터링 하더라도 유사한 결과를 얻을 수 있다. 책임 주도 설계를 무조건 단계적으로 따를 필요는 없다.

### 메서드 응집도

- 몬스터 메서드 : 긴 메서드는 응집도가 낮아 이해하기 어렵고, 재사용하기 어려우며, 변경하기 어렵다.
- 주석을 추가하는 대신 메서드를 작게 분해해서 각 메서드의 응집도를 높여라.

> **마틴파울러의 메서드의 이름에 대한 생각**
> 
> **짧고, 이해하기 쉬운 이름으로 된 메서드를 좋아한다**
> 
> 1. 메서드가 잘게 나눠져있을때 다른 메서드에서 사용될 확률이 높아진다.
> 2. 고수준의 메서드를 볼때 일련의 주석을 읽는 것 같은 느낌이 들게 할 수 있다.
> 
> **이름의 길이**
> 
> 길이는 중요하지 않다. 메서드의 이름이 코드를 더 명확하게 한다면 메서드의 이름이 코드보다 더 길어져도 된다.

## 후기

처음부터 책임주도 설계를 하는 방법은 사실 잘 와닿지 않았다. 데이터는 직관적으로 드러나는 부분이 많아서 보통 데이터 중심으로 객체를 먼저 설계하고 이후에 객체지향적으로 개선하곤 했는데, 이것이 더 좋은 방법같다. 
책임 주도 설계가 무서워서, 구더기 무서워서 장 못담그는 상황은 애자일을 하는 사람에게 일어나선 안되기에, 일단 설계하고 바꾸자~
